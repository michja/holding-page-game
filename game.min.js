'use strict';var stage=document.querySelector('.stage'),track=stage.querySelector('.track'),disc=document.querySelector('.disc'),modal=document.querySelector('.modal'),ship=document.querySelector('.ship'),clip=document.querySelector('.clip'),overlay=document.querySelector('.overlay'),running,winner;function fade(a){a.classList.add('is-faded')}function scale(a){a.classList.add('is-small')}function bounce(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:3;a.style.animationDuration=b+'s',a.classList.add('is-moving')}function loadClip(){for(var b,a=0;a<clip.dataset.shots;a++)b=document.createElement('div'),b.classList.add('laser'),clip.appendChild(b);clip.classList.remove('is-faded')}function moveShip(){bounce(ship,2)}function lose(){overlay.addEventListener('transitionend',function(a){'transform'!==a.propertyName||setTimeout(function(){overlay.classList.remove('is-ended'),disc.classList.add('is-faded'),end()},500)}),overlay.classList.add('is-active'),setTimeout(function(){overlay.classList.add('is-ended')},20),ship.classList.add('is-dead')}function end(){modal.classList.remove('is-faded'),ship.classList.add('is-faded'),clip.classList.add('is-faded'),modal.classList.add('is-ended')}function win(){end()}function removeShot(){var a=clip.querySelectorAll('.laser:not(.is-faded)');if(a.length){var b=a.length-1,c=a[b];fade(c),0==b&&(running=!1),c.addEventListener('transitionend',function(d){'opacity'!==d.propertyName||clip.removeChild(c)})}}function fire(){var a=document.createElement('div');a.classList.add('laser','is-active'),a.style.left=ship.offsetLeft+ship.width/2+'px',track.appendChild(a),monitor(a),removeShot(),a.addEventListener('transitionend',function(b){if('bottom'===b.propertyName){removeLaser(a);var c=stage.querySelectorAll('.laser:not(.is-faded)');c.length||lose()}}),setTimeout(function(){return a.classList.add('is-firing')},50)}function randomTime(a,b){return Math.round(Math.random()*(b-a)+a)}function wrap(a){var b=document.createElement('div'),c=a.getBoundingClientRect();b.classList.add('wrap'),b.style.left=c.left+'px',b.style.top=c.top+'px',b.style.height=c.height+'px',b.style.width=c.width+'px',track.removeChild(a),b.appendChild(a),stage.appendChild(b)}function removeLaser(a){'interval'in a.dataset&&window.clearInterval(a.dataset.interval),track.removeChild(a)}function explode(a,b,c){var d=Array.apply(null,Array(c)),f=d.map(function(g,h){var j=document.createElement('div');return j.classList.add('string'),j.style.top=b+'px',j.style.left=a+'px',j.style.transform='rotate('+360*h/d.length+'deg)',j});f.forEach(function(g){stage.appendChild(g),g.addEventListener('transitionend',function(h){'height'!==h.propertyName||g.classList.add('shoot')}),g.addEventListener('transitionend',function(h){'bottom'!==h.propertyName&&running||(running=!1,win())}),setTimeout(function(){return g.classList.add('stretch')},50)})}function hit(){wrap(disc),disc.classList.remove('is-moving'),setTimeout(function(){disc.addEventListener('transitionend',function(a){if('transform'===a.propertyName){var b=disc.getBoundingClientRect();stage.removeChild(stage.querySelector('.wrap')),explode(b.left,b.top,16)}}),disc.classList.add('is-shrunk')},50)}function start(a){'transform'!==a.propertyName||(bounce(disc),ship.classList.add('is-shown'),loadClip(),disc.removeEventListener('transitionend',start),running=!0)}function monitor(a){var b=setInterval(function(){var c=disc.getBoundingClientRect(),d=a.getBoundingClientRect();d.top>c.top&&d.top<c.bottom&&d.left>c.left&&d.left<c.right&&(removeLaser(a),hit())},50);a.dataset.interval=b}document.addEventListener('keydown',function(a){running&&'Space'===a.code&&fire()}),document.addEventListener('touchstart',function(){running&&fire()}),ship.addEventListener('transitionend',function(a){'opacity'!==a.propertyName||setTimeout(function(){moveShip()},randomTime(10,1500))}),setTimeout(function(){fade(modal),modal.addEventListener('transitionend',function(a){'opacity'!==a.propertyName||(scale(disc),disc.addEventListener('transitionend',start,{once:!0}))})},1500);
